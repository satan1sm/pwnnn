#!/usr/bin/env python3
# -*- encoding: utf-8 -*-

import os
import gzip
from pwn import *
context.update(arch = 'amd64', os = 'linux', log_level = 'info')


# Byte sequence alias
A4 = 4 * b'A'
A8 = 8 * b'A'


def main():
    # JZC33MJPDC48UXXJ94BBQOR0JJR4AO0W02PHZ4VZRJAEXL3OUI02FQ4GSQIDGBFT70VESKNAAUEJW4RR9EQOCJ9PKT7W9FBMJDVK6X9MT7K1HY30MSA4H3Y9FTV0O7Z6FQ5I1J8R6KSCMWKFSDGCMWARIJTLPLRO8KUYQW2F46ZV6YWIVFNCZDQRCTAM5JVGQMEU2LFPS5DUDOY4130XB50V91PWHCIO0AD1RHTR673DPX36TA2UWA48FD34Y2W6
    # 1ZS4WIFP2GVZRR2BVIGVG7PBIJEVS9OOARB911S3ICDDYYZHGUOCCWRGD3GSY5J0FEC33TZGIPHWO9CXF1MCTHL1ELV7KRIJRLLIF241CXCOX2BYRIU1S95ZIBXYVOP54WK9KG2WK6MJ2AH4VNAX8V1TZWRO5ZE6TU6L2P9Y1FTO0O634AZ7YMK0BZDX3RP9MRVA3H7FMHHJ4WF4DKLPLF05XHE8DAVQCKE196HH4G2QMFKHCCT6VDOMWOVXH7H8
    i = 0

    while True:
        with gzip.open('./gift.gz', 'rb') as f:
            file_content = f.read()

        with open('./gift', 'wb') as f:
            f.write(file_content)

        os.system('chmod u+x ./gift')

        elf = ELF('./gift')
        passwd = elf.read(0xA10, 256)
        log.info('[{}] {}'.format(i, passwd))

        proc = elf.process()
        proc.sendline(passwd)
        proc.recvuntil('Ok, that sounds good\n')
        output = proc.recvall()

        with open('./gift.gz', 'wb') as f:
            f.write(output)

        i += 1


if __name__ == '__main__':
    main()
