#!/usr/bin/env python3
# -*- encoding: utf-8 -*-

import os
import gzip
from pwn import *
context.update(arch = 'amd64', os = 'linux', log_level = 'info')

def main():
    i = 0

    while True:
        with gzip.open('./gift.gz', 'rb') as f:
            file_content = f.read()

        with open('./gift', 'wb') as f:
            f.write(file_content)

        os.system('chmod u+x ./gift')

        elf = ELF('./gift')
        passwd = elf.read(0xA10, 256)
        log.info('[{}] {}'.format(i, passwd))

        proc = elf.process()
        proc.sendline(passwd)
        proc.recvuntil('Ok, that sounds good\n')
        output = proc.recvall()

        with open('./gift.gz', 'wb') as f:
            f.write(output)

        i += 1


if __name__ == '__main__':
    main()
